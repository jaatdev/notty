{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Hierarchical User Notes Structure",
  "description": "Schema for organizing user notes by Subject → Topic → Subtopic hierarchy",
  "type": "object",
  "properties": {
    "subjects": {
      "type": "object",
      "description": "Notes organized by subject slug",
      "patternProperties": {
        "^[a-z-]+$": {
          "type": "object",
          "properties": {
            "metadata": {
              "type": "object",
              "properties": {
                "title": { "type": "string" },
                "slug": { "type": "string" },
                "totalNotes": { "type": "number" },
                "lastUpdated": { "type": "string", "format": "date-time" }
              }
            },
            "topics": {
              "type": "object",
              "description": "Notes organized by topic ID",
              "patternProperties": {
                "^[a-z0-9-]+$": {
                  "type": "object",
                  "properties": {
                    "topicId": { "type": "string" },
                    "topicTitle": { "type": "string" },
                    "notes": {
                      "type": "array",
                      "description": "Topic-level notes",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "string" },
                          "title": { "type": "string" },
                          "content": { "type": "string" },
                          "tags": { "type": "array", "items": { "type": "string" } },
                          "createdAt": { "type": "string", "format": "date-time" },
                          "updatedAt": { "type": "string", "format": "date-time" },
                          "metadata": {
                            "type": "object",
                            "properties": {
                              "wordCount": { "type": "number" },
                              "readingTime": { "type": "number" },
                              "isPinned": { "type": "boolean" },
                              "isArchived": { "type": "boolean" }
                            }
                          }
                        },
                        "required": ["id", "title", "content", "createdAt", "updatedAt"]
                      }
                    },
                    "subtopics": {
                      "type": "object",
                      "description": "Subtopic-level notes",
                      "patternProperties": {
                        "^[a-z0-9-]+$": {
                          "type": "object",
                          "properties": {
                            "subtopicId": { "type": "string" },
                            "subtopicTitle": { "type": "string" },
                            "notes": {
                              "type": "array",
                              "items": {
                                "$ref": "#/properties/subjects/patternProperties/%5E%5Ba-z-%5D%2B%24/properties/topics/patternProperties/%5E%5Ba-z0-9-%5D%2B%24/properties/notes/items"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "version": {
      "type": "string",
      "description": "Schema version for migration compatibility"
    },
    "lastSync": {
      "type": "string",
      "format": "date-time",
      "description": "Last synchronization timestamp"
    }
  },
  "required": ["subjects", "version"]
}
